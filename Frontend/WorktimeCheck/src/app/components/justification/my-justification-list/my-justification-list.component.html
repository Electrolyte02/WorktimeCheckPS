<div class="list--container">
  <div class="list--header">
    <h2>Lista de Justificaciones</h2>
  </div>
  <div class="list--body">
    <div class="list--actions">
      <button>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-file-earmark-excel"
          viewBox="0 0 16 16"
        >
          <path
            d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z"
          />
          <path
            d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"
          />
        </svg>
      </button>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">Empleado</th>
          <th scope="col">Estado</th>
          <th scope="col">Fecha</th>
          <th scope="col">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (justification of justificationList; track $index) {
        <tr>
          <td>{{ justification.employeeFullName }}</td>
          <td>
            <span [class]="getStateClass(justification.justificationState)">
              {{ getStateText(justification.justificationState) }}
            </span>
          </td>
          <td>{{ formatDate(justification.justificationDate) }}</td>
          <td>
            <div class="action-buttons">
              <!-- Always show the view justification button -->
              <button 
                class="view--button" 
                (click)="viewJustification(justification.justificationId)"
                title="Ver detalles"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-eye"
                  viewBox="0 0 16 16"
                >
                  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                  <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                </svg>
              </button>
              
              <!-- Show check button only for approved (2) or rejected (3) states -->
              <button 
                *ngIf="hasCheckAvailable(justification.justificationState)"
                class="check--button" 
                (click)="viewJustificationCheck(justification.justificationId)"
                title="Ver revisión"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-clipboard-check"
                  viewBox="0 0 16 16"
                >
                  <path fill-rule="evenodd" d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0"/>
                  <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1z"/>
                  <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0z"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
        }
        @empty {
        <tr>
          <td colspan="5" class="text-center">No se encontraron justificaciones</td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  <div class="list--pagination">
    <div class="pagination-left">
      <label for="size-select">Cantidad:</label>
      <select id="size-select" [(ngModel)]="size" (change)="fetchJustifications()">
        <option [value]="5">5</option>
        <option [value]="10">10</option>
        <option [value]="20">20</option>
      </select>
    </div>
    <div class="pagination-right">
      <button (click)="previousPage()" [disabled]="page === 0">«</button>
      <ng-container *ngFor="let p of totalPagesArray; let i = index">
        <button (click)="goToPage(i)" [class.active]="page === i">
          {{ i + 1 }}
        </button>
      </ng-container>
      <button (click)="nextPage()" [disabled]="page >= totalPages - 1">
        »
      </button>
    </div>
  </div>
</div>

<!-- Modal for Check Details -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Detalles</h3>
      <button class="close-button" (click)="closeModal()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          fill="currentColor"
          class="bi bi-x"
          viewBox="0 0 16 16"
        >
          <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
        </svg>
      </button>
    </div>
    
    <div class="modal-body">
      <div *ngIf="isLoadingCheck" class="loading-container">
        <div class="spinner"></div>
        <p>Cargando detalles...</p>
      </div>
      
      <div *ngIf="!isLoadingCheck && checkDetails" class="check-section">
        <h3>Decisión</h3>
        
        <div class="row">
          <div class="input-field">
            <div class="approval-buttons">
              <button 
                type="button"
                class="approval-btn approve-btn"
                [class.active]="checkDetails.checkApproval === true"
                disabled>
                ✓ Aprobado
              </button>
              <button 
                type="button"
                class="approval-btn reject-btn"
                [class.active]="checkDetails.checkApproval === false"
                disabled>
                ✗ Rechazado
              </button>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="input-field">
            <label>
              Razón de la decisión
              <span class="help-text">
                ({{ checkDetails.checkApproval === true ? 'Motivo de aprobación' : 'Motivo de rechazo' }})
              </span>
            </label>
            <textarea
              rows="4"
              [value]="checkDetails.checkReason"
              readonly
              class="readonly-textarea">
            </textarea>
          </div>
        </div>

      <div *ngIf="!isLoadingCheck && !checkDetails" class="error-message">
        <p>No se pudieron cargar los detalles de la revisión.</p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">Cerrar</button>
    </div>
  </div>
</div>